{% extends "events/event_base.html" %}
{% load url from future %}
{% block head_title %}
Programme
{% endblock %}

{% block tab %}
	<ul class="nav nav-tabs">
	  <li><a href="{% url 'events-list' %}">List</a></li>
	  <li class="active"><a href="{% url 'events-map' %}">Map</a></li>
	</ul>
	{% include 'participant/category_filter.html' with action_url_name='events-map' %}
	<div class="row">
			<div class="span6">
	    	{% include "maps/_map.html" %}
	        <style type="text/css">
	            #map_canvas{
	                height: 400px;
	            }
	        </style>
	        {% if map_bounds %}
				<script type="text/javascript">
					$(window).ready(function(){ 
	                	SSOUK.map_handler.map.fitBounds({{map_bounds}});
	             	});
	            </script>
	        {% endif %}
		</div>	
		  <div class="span6">
		  	
		  	
		  	{% for location in object_list %}
			  	{% if location.event_set.count > 0 %}
				    {% for event_obj in location.event_set.all %}
						{% include "events/_event_snippet.html" %}
			      	{% endfor %}
			    <script type="text/javascript">
	               $(document).ready(function(){
	                       
	                   var info_text = "<ul class=\"unstyled\">" 
	                       {% for event_obj in location.event_set.all %}
	                       var info_list = "<li><a href=\"{% url 'event-detail' event_obj.id %}\">{{ event_obj.name }}</a></li>";
	                       info_text = info_text + info_list;   
	                       {% endfor %}
	                       info_text = info_text + "</ul>"; 
	                   SSOUK.map_handler.updateMarker({{ location.marker.y }}, 
	                                                  {{ location.marker.x }},
	                                                  info_text,
	                                                  {{ location.id }}
	                                                  );
	               }); 
				</script>
				{% endif %}
		    {% endfor %}
		</div>
	</div>
{% endblock%}
